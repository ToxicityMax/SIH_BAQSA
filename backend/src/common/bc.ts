import { ethers } from 'ethers';
import config from '../config';
const ABI = {
  _format: 'hh-sol-artifact-1',
  contractName: 'SupplyChainEncoded',
  sourceName: 'contracts/SupplyChain2.sol',
  abi: [
    {
      inputs: [
        {
          internalType: 'string',
          name: '_orderId',
          type: 'string',
        },
        {
          internalType: 'string',
          name: '_schema_type',
          type: 'string',
        },
        {
          internalType: 'string',
          name: '_jsonData',
          type: 'string',
        },
      ],
      name: 'createNewOrder',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'string',
          name: '_orderId',
          type: 'string',
        },
      ],
      name: 'getOrderDetails',
      outputs: [
        {
          components: [
            {
              internalType: 'string',
              name: 'schema_type',
              type: 'string',
            },
            {
              internalType: 'string',
              name: 'jsonData',
              type: 'string',
            },
          ],
          internalType: 'struct SupplyChainEncoded.ProductHistory[]',
          name: '',
          type: 'tuple[]',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'string',
          name: '',
          type: 'string',
        },
        {
          internalType: 'uint256',
          name: '',
          type: 'uint256',
        },
      ],
      name: 'history',
      outputs: [
        {
          internalType: 'string',
          name: 'schema_type',
          type: 'string',
        },
        {
          internalType: 'string',
          name: 'jsonData',
          type: 'string',
        },
      ],
      stateMutability: 'view',
      type: 'function',
    },
    {
      inputs: [
        {
          internalType: 'string',
          name: '_orderId',
          type: 'string',
        },
        {
          internalType: 'string',
          name: '_schema_type',
          type: 'string',
        },
        {
          internalType: 'string',
          name: '_jsonData',
          type: 'string',
        },
      ],
      name: 'insertNewEntry',
      outputs: [],
      stateMutability: 'nonpayable',
      type: 'function',
    },
  ],
  bytecode:
    '0x608060405234801561001057600080fd5b50610b96806100206000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806345820886146100515780634fbb487c1461006d578063978080581461009d578063abe7e4be146100ce575b600080fd5b61006b60048036038101906100669190610699565b6100ea565b005b61008760048036038101906100829190610658565b61018d565b604051610094919061090b565b60405180910390f35b6100b760048036038101906100b29190610730565b61032e565b6040516100c592919061092d565b60405180910390f35b6100e860048036038101906100e39190610699565b610495565b005b6000604051806040016040528084815260200183815250905060008460405161011391906108f4565b90815260200160405180910390208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610167929190610538565b506020820151816001019080519060200190610184929190610538565b50505050505050565b606060008260405161019f91906108f4565b9081526020016040518091039020805480602002602001604051908101604052809291908181526020016000905b82821015610323578382906000526020600020906002020160405180604001604052908160008201805461020090610a77565b80601f016020809104026020016040519081016040528092919081815260200182805461022c90610a77565b80156102795780601f1061024e57610100808354040283529160200191610279565b820191906000526020600020905b81548152906001019060200180831161025c57829003601f168201915b5050505050815260200160018201805461029290610a77565b80601f01602080910402602001604051908101604052809291908181526020018280546102be90610a77565b801561030b5780601f106102e05761010080835404028352916020019161030b565b820191906000526020600020905b8154815290600101906020018083116102ee57829003601f168201915b505050505081525050815260200190600101906101cd565b505050509050919050565b600082805160208101820180518482526020830160208501208183528095505050505050818154811061036057600080fd5b90600052602060002090600202016000915091505080600001805461038490610a77565b80601f01602080910402602001604051908101604052809291908181526020018280546103b090610a77565b80156103fd5780601f106103d2576101008083540402835291602001916103fd565b820191906000526020600020905b8154815290600101906020018083116103e057829003601f168201915b50505050509080600101805461041290610a77565b80601f016020809104026020016040519081016040528092919081815260200182805461043e90610a77565b801561048b5780601f106104605761010080835404028352916020019161048b565b820191906000526020600020905b81548152906001019060200180831161046e57829003601f168201915b5050505050905082565b600060405180604001604052808481526020018381525090506000846040516104be91906108f4565b90815260200160405180910390208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610512929190610538565b50602082015181600101908051906020019061052f929190610538565b50505050505050565b82805461054490610a77565b90600052602060002090601f01602090048101928261056657600085556105ad565b82601f1061057f57805160ff19168380011785556105ad565b828001600101855582156105ad579182015b828111156105ac578251825591602001919060010190610591565b5b5090506105ba91906105be565b5090565b5b808211156105d75760008160009055506001016105bf565b5090565b60006105ee6105e984610989565b610964565b90508281526020810184848401111561060657600080fd5b610611848285610a35565b509392505050565b600082601f83011261062a57600080fd5b813561063a8482602086016105db565b91505092915050565b60008135905061065281610b49565b92915050565b60006020828403121561066a57600080fd5b600082013567ffffffffffffffff81111561068457600080fd5b61069084828501610619565b91505092915050565b6000806000606084860312156106ae57600080fd5b600084013567ffffffffffffffff8111156106c857600080fd5b6106d486828701610619565b935050602084013567ffffffffffffffff8111156106f157600080fd5b6106fd86828701610619565b925050604084013567ffffffffffffffff81111561071a57600080fd5b61072686828701610619565b9150509250925092565b6000806040838503121561074357600080fd5b600083013567ffffffffffffffff81111561075d57600080fd5b61076985828601610619565b925050602061077a85828601610643565b9150509250929050565b600061079083836108b0565b905092915050565b60006107a3826109ca565b6107ad81856109ed565b9350836020820285016107bf856109ba565b8060005b858110156107fb57848403895281516107dc8582610784565b94506107e7836109e0565b925060208a019950506001810190506107c3565b50829750879550505050505092915050565b6000610818826109d5565b61082281856109fe565b9350610832818560208601610a44565b61083b81610b38565b840191505092915050565b6000610851826109d5565b61085b8185610a0f565b935061086b818560208601610a44565b61087481610b38565b840191505092915050565b600061088a826109d5565b6108948185610a20565b93506108a4818560208601610a44565b80840191505092915050565b600060408301600083015184820360008601526108cd828261080d565b915050602083015184820360208601526108e7828261080d565b9150508091505092915050565b6000610900828461087f565b915081905092915050565b600060208201905081810360008301526109258184610798565b905092915050565b600060408201905081810360008301526109478185610846565b9050818103602083015261095b8184610846565b90509392505050565b600061096e61097f565b905061097a8282610aa9565b919050565b6000604051905090565b600067ffffffffffffffff8211156109a4576109a3610b09565b5b6109ad82610b38565b9050602081019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b6000819050919050565b82818337600083830152505050565b60005b83811015610a62578082015181840152602081019050610a47565b83811115610a71576000848401525b50505050565b60006002820490506001821680610a8f57607f821691505b60208210811415610aa357610aa2610ada565b5b50919050565b610ab282610b38565b810181811067ffffffffffffffff82111715610ad157610ad0610b09565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b610b5281610a2b565b8114610b5d57600080fd5b5056fea2646970667358221220bd068cefc6cb9a0e0bfa0895a2d183d05ec0ce317d3b232fb79c560e985ecb8864736f6c63430008040033',
  deployedBytecode:
    '0x608060405234801561001057600080fd5b506004361061004c5760003560e01c806345820886146100515780634fbb487c1461006d578063978080581461009d578063abe7e4be146100ce575b600080fd5b61006b60048036038101906100669190610699565b6100ea565b005b61008760048036038101906100829190610658565b61018d565b604051610094919061090b565b60405180910390f35b6100b760048036038101906100b29190610730565b61032e565b6040516100c592919061092d565b60405180910390f35b6100e860048036038101906100e39190610699565b610495565b005b6000604051806040016040528084815260200183815250905060008460405161011391906108f4565b90815260200160405180910390208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610167929190610538565b506020820151816001019080519060200190610184929190610538565b50505050505050565b606060008260405161019f91906108f4565b9081526020016040518091039020805480602002602001604051908101604052809291908181526020016000905b82821015610323578382906000526020600020906002020160405180604001604052908160008201805461020090610a77565b80601f016020809104026020016040519081016040528092919081815260200182805461022c90610a77565b80156102795780601f1061024e57610100808354040283529160200191610279565b820191906000526020600020905b81548152906001019060200180831161025c57829003601f168201915b5050505050815260200160018201805461029290610a77565b80601f01602080910402602001604051908101604052809291908181526020018280546102be90610a77565b801561030b5780601f106102e05761010080835404028352916020019161030b565b820191906000526020600020905b8154815290600101906020018083116102ee57829003601f168201915b505050505081525050815260200190600101906101cd565b505050509050919050565b600082805160208101820180518482526020830160208501208183528095505050505050818154811061036057600080fd5b90600052602060002090600202016000915091505080600001805461038490610a77565b80601f01602080910402602001604051908101604052809291908181526020018280546103b090610a77565b80156103fd5780601f106103d2576101008083540402835291602001916103fd565b820191906000526020600020905b8154815290600101906020018083116103e057829003601f168201915b50505050509080600101805461041290610a77565b80601f016020809104026020016040519081016040528092919081815260200182805461043e90610a77565b801561048b5780601f106104605761010080835404028352916020019161048b565b820191906000526020600020905b81548152906001019060200180831161046e57829003601f168201915b5050505050905082565b600060405180604001604052808481526020018381525090506000846040516104be91906108f4565b90815260200160405180910390208190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000019080519060200190610512929190610538565b50602082015181600101908051906020019061052f929190610538565b50505050505050565b82805461054490610a77565b90600052602060002090601f01602090048101928261056657600085556105ad565b82601f1061057f57805160ff19168380011785556105ad565b828001600101855582156105ad579182015b828111156105ac578251825591602001919060010190610591565b5b5090506105ba91906105be565b5090565b5b808211156105d75760008160009055506001016105bf565b5090565b60006105ee6105e984610989565b610964565b90508281526020810184848401111561060657600080fd5b610611848285610a35565b509392505050565b600082601f83011261062a57600080fd5b813561063a8482602086016105db565b91505092915050565b60008135905061065281610b49565b92915050565b60006020828403121561066a57600080fd5b600082013567ffffffffffffffff81111561068457600080fd5b61069084828501610619565b91505092915050565b6000806000606084860312156106ae57600080fd5b600084013567ffffffffffffffff8111156106c857600080fd5b6106d486828701610619565b935050602084013567ffffffffffffffff8111156106f157600080fd5b6106fd86828701610619565b925050604084013567ffffffffffffffff81111561071a57600080fd5b61072686828701610619565b9150509250925092565b6000806040838503121561074357600080fd5b600083013567ffffffffffffffff81111561075d57600080fd5b61076985828601610619565b925050602061077a85828601610643565b9150509250929050565b600061079083836108b0565b905092915050565b60006107a3826109ca565b6107ad81856109ed565b9350836020820285016107bf856109ba565b8060005b858110156107fb57848403895281516107dc8582610784565b94506107e7836109e0565b925060208a019950506001810190506107c3565b50829750879550505050505092915050565b6000610818826109d5565b61082281856109fe565b9350610832818560208601610a44565b61083b81610b38565b840191505092915050565b6000610851826109d5565b61085b8185610a0f565b935061086b818560208601610a44565b61087481610b38565b840191505092915050565b600061088a826109d5565b6108948185610a20565b93506108a4818560208601610a44565b80840191505092915050565b600060408301600083015184820360008601526108cd828261080d565b915050602083015184820360208601526108e7828261080d565b9150508091505092915050565b6000610900828461087f565b915081905092915050565b600060208201905081810360008301526109258184610798565b905092915050565b600060408201905081810360008301526109478185610846565b9050818103602083015261095b8184610846565b90509392505050565b600061096e61097f565b905061097a8282610aa9565b919050565b6000604051905090565b600067ffffffffffffffff8211156109a4576109a3610b09565b5b6109ad82610b38565b9050602081019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b6000819050919050565b82818337600083830152505050565b60005b83811015610a62578082015181840152602081019050610a47565b83811115610a71576000848401525b50505050565b60006002820490506001821680610a8f57607f821691505b60208210811415610aa357610aa2610ada565b5b50919050565b610ab282610b38565b810181811067ffffffffffffffff82111715610ad157610ad0610b09565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b6000601f19601f8301169050919050565b610b5281610a2b565b8114610b5d57600080fd5b5056fea2646970667358221220bd068cefc6cb9a0e0bfa0895a2d183d05ec0ce317d3b232fb79c560e985ecb8864736f6c63430008040033',
  linkReferences: {},
  deployedLinkReferences: {},
};

const provider = new ethers.providers.JsonRpcProvider(
  'https://polygon-mumbai.g.alchemy.com/v2/IMRPQN_QWuDBJiqEZA9SokxQNPDdi8qT',
);
const contractAddress = '0x34A11280aDa76602B80C593AA8d124B805dCbD29';
const wallet = new ethers.Wallet(config.BC_PRIVATE_KEY, provider);

const contract = new ethers.Contract(contractAddress, ABI.abi, provider);
export const contractWithWallet = contract.connect(wallet);

export async function insertNewEntry(_orderId, _schemaType, _jsonData) {
  const gas = provider.getGasPrice();
  const _insertNewEntry = await contractWithWallet.insertNewEntry(
    _orderId,
    _schemaType,
    _jsonData,
    { maxFeePerGas: gas, maxPriorityFeePerGas: gas, gasLimit: 2100000 },
  );
  _insertNewEntry.wait();
  console.log(_insertNewEntry);
}

export async function getOrderDetails(_orderId) {
  return await contractWithWallet.getOrderDetails(_orderId);
}
